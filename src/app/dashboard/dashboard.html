<div class="dashboard-container" *ngIf="!isAdmin">
  <!-- Header with user greeting -->
  <div class="dashboard-header">
    <div class="greeting">
      <h1>¬°Hola, {{ username }}!</h1>
      <p>Aqu√≠ est√° tu resumen financiero</p>
    </div>
    <button class="btn-new-transaction" (click)="goToNewTransaction()">
      <span class="icon">+</span>
      Nueva Transacci√≥n
    </button>
  </div>

  <!--Summary Cards -->
  <div class="summary-cards">
    <div class="summary-card balance">
      <div class="card-icon">üí∞</div>
      <div class="card-content">
        <p class="card-label">Saldo Actual</p>
        <h2 class="card-value">‚Ç¨{{ currentBalance.toLocaleString('es-ES', {minimumFractionDigits: 2}) }}</h2>
      </div>
    </div>

    <div class="summary-card income">
      <div class="card-icon">üìà</div>
      <div class="card-content">
        <p class="card-label">Ingresos del Mes</p>
        <h2 class="card-value">‚Ç¨{{ currentMonthIncome.toLocaleString('es-ES', {minimumFractionDigits: 2}) }}</h2>
      </div>
    </div>

    <div class="summary-card expenses">
      <div class="card-icon">üìâ</div>
      <div class="card-content">
        <p class="card-label">Gastos del Mes</p>
        <h2 class="card-value">‚Ç¨{{ currentMonthExpenses.toLocaleString('es-ES', {minimumFractionDigits: 2}) }}</h2>
      </div>
    </div>

    <div class="summary-card savings" [class.negative]="currentMonthSavings < 0">
      <div class="card-icon">{{ currentMonthSavings >= 0 ? '‚ú®' : '‚ö†Ô∏è' }}</div>
      <div class="card-content">
        <p class="card-label">Ahorro del Mes</p>
        <h2 class="card-value">‚Ç¨{{ currentMonthSavings.toLocaleString('es-ES', {minimumFractionDigits: 2}) }}</h2>
      </div>
    </div>
  </div>

  <!-- Charts Section -->
  <div class="charts-section">
    <!-- Income vs Expenses Chart -->
    <div class="chart-card">
      <div class="card-header">
        <h3>√öltimos 3 Meses</h3>
        <p>Comparaci√≥n de ingresos y gastos</p>
      </div>
      <div class="chart-content">
        <div class="bar-chart">
          <div class="chart-bars">
            <div class="bar-group" *ngFor="let data of chartData">
              <div class="bar-wrapper">
                <div class="bar income-bar" [style.height.%]="getBarHeight(data.income)">
                  <span class="bar-value">‚Ç¨{{ data.income.toLocaleString('es-ES', {maximumFractionDigits: 0}) }}</span>
                </div>
                <div class="bar expense-bar" [style.height.%]="getBarHeight(data.expense)">
                  <span class="bar-value">‚Ç¨{{ data.expense.toLocaleString('es-ES', {maximumFractionDigits: 0}) }}</span>
                </div>
              </div>
              <span class="bar-label">{{ data.month }}</span>
            </div>
          </div>
          <div class="chart-legend">
            <div class="legend-item">
              <span class="legend-color income"></span>
              <span>Ingresos</span>
            </div>
            <div class="legend-item">
              <span class="legend-color expense"></span>
              <span>Gastos</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Income/Expense Percentage -->
    <div class="chart-card percentage-card">
      <div class="card-header">
        <h3>Distribuci√≥n Mensual</h3>
        <p>Ingresos vs Gastos</p>
      </div>
      <div class="percentage-content">
        <div class="percentage-circle">
          <svg viewBox="0 0 200 200">
            <circle cx="100" cy="100" r="80" fill="none" stroke="#e0e0e0" stroke-width="20" />
            <circle cx="100" cy="100" r="80" fill="none" stroke="#4caf50" stroke-width="20"
              [attr.stroke-dasharray]="(incomePercentage / 100) * 502.65 + ' 502.65'" transform="rotate(-90 100 100)" />
            <circle cx="100" cy="100" r="80" fill="none" stroke="#f44336" stroke-width="20"
              [attr.stroke-dasharray]="(expensesPercentage / 100) * 502.65 + ' 502.65'"
              [attr.stroke-dashoffset]="-(incomePercentage / 100) * 502.65" transform="rotate(-90 100 100)" />
          </svg>
          <div class="percentage-center">
            <span class="percentage-label">Balance</span>
          </div>
        </div>
        <div class="percentage-stats">
          <div class="percentage-row income-row">
            <span class="percentage-label">Ingresos</span>
            <span class="percentage-value">{{ incomePercentage.toFixed(1) }}%</span>
          </div>
          <div class="percentage-row expense-row">
            <span class="percentage-label">Gastos</span>
            <span class="percentage-value">{{ expensesPercentage.toFixed(1) }}%</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Bottom Section -->
  <div class="bottom-section">
    <!-- Concepto Distribution -->
    <div class="chart-card conceptos-card">
      <div class="card-header">
        <h3>Gastos por Concepto</h3>
        <p>Top 3 del mes actual</p>
      </div>
      <div class="conceptos-content">
        <div class="concepto-item" *ngFor="let concepto of topConceptos">
          <div class="concepto-info">
            <span class="concepto-name">{{ concepto.concepto }}</span>
            <span class="concepto-amount">‚Ç¨{{ concepto.total.toLocaleString('es-ES', {minimumFractionDigits: 2})
              }}</span>
          </div>
          <div class="concepto-bar-wrapper">
            <div class="concepto-bar" [style.width.%]="getConceptoPercentage(concepto)"></div>
          </div>
          <span class="concepto-percentage">{{ getConceptoPercentage(concepto).toFixed(1) }}%</span>
        </div>
        <div class="no-data" *ngIf="conceptoDistribution.length === 0">
          <p>No hay gastos este mes</p>
        </div>
      </div>
    </div>

    <!-- Recent Transactions -->
    <div class="chart-card transactions-card">
      <div class="card-header">
        <h3>Transacciones Recientes</h3>
        <p>√öltimas transacciones</p>
      </div>
      <div class="transactions-content">
        <div class="transaction-item" *ngFor="let transaction of recentTransactions">
          <div class="transaction-icon" [class]="transaction.tipo.nombre.toLowerCase()">
            {{ transaction.tipo.nombre === 'INGRESO' ? '‚Üë' : '‚Üì' }}
          </div>
          <div class="transaction-info">
            <span class="transaction-concept">{{ transaction.concepto.nombre }}</span>
            <span class="transaction-date">{{ transaction.fecha }}</span>
          </div>
          <span class="transaction-amount" [class]="transaction.tipo.nombre.toLowerCase()">
            {{ transaction.tipo.nombre === 'INGRESO' ? '+' : '-' }}‚Ç¨{{ transaction.cantidad.toLocaleString('es-ES',
            {minimumFractionDigits: 2}) }}
          </span>
        </div>
        <div class="no-data" *ngIf="recentTransactions.length === 0">
          <p>No hay transacciones recientes</p>
        </div>
      </div>
      <button class="btn-view-all" (click)="goToFinanzas()">Ver Todas</button>
    </div>
  </div>
</div>